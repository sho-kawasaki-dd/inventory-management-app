{% extends "layout.html" %}
{% block content %}
<h1>棚卸</h1>
<form id="new-stocktake-form">
  <input type="text" name="title" placeholder="タイトル" required />
  <button class="btn primary" type="submit">現在の在庫から棚卸を作成</button>
</form>

<h2>一覧</h2>
<table id="stocktakes-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>タイトル</th>
      <th>行数</th>
      <th>差異数</th>
      <th>ステータス</th>
      <th></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
{% endblock %}
{% block scripts %}
<script>
  window.InventoryApp.loadStocktakes();
  document.getElementById('new-stocktake-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const payload = { title: fd.get('title') };
    const res = await window.InventoryApp.api('/api/stocktakes', { method: 'POST', body: JSON.stringify(payload) });
    const data = await res.json();
    window.location.href = `/stocktakes/${data.id}`;
  });
</script>
{% endblock %}
